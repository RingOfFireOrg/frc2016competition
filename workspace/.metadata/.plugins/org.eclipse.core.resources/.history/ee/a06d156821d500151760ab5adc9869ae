package org.usfirst.frc.team3459.robot;

import edu.wpi.first.wpilibj.CANTalon;
import edu.wpi.first.wpilibj.DriverStation;

public class Shooter {
	public static final double INSPEED = -0.6;
	public static final double OUTSPEED = 1;
	public static final double STOP = 0;
	double lastSpeed = 0;
	
	public static final long FIREDURATION = 1000;
	
	public enum Mode {SHOOTUP,SHOOTDOWN,INTAKE,DOWN,UP,DISABLE}

	Mode mode = Mode.DISABLE;
	Mode lastMode = mode;
	boolean changingMode = false;
	
	boolean startFire = false;
	boolean firing = false;
	long startShootDown = System.currentTimeMillis();
	//***************************************************************************************
	
	CANTalon motor1, motor2;
	Trigger trigger;
	Tilter tilter;
	
	public Shooter(int m1, int m2, int s1, int t1, int t2) {
		motor1 = new CANTalon(m1);
		motor2 = new CANTalon(m2);
		trigger = new Trigger(s1);
		tilter = new Tilter(t1,t2,false);
	}
	
	public void update() {
		trigger.update();
		
		switch(mode) {
		case DISABLE:
			setWheels(STOP);
			break;
		
		case INTAKE:
			setWheels(INSPEED);
			break;
		
		case SHOOTUP:
			setWheels(OUTSPEED);
			
			if(startFire) {
				trigger.fire();
				startFire = false;
			}
			break;
		
		case SHOOTDOWN:
			if(changingMode) {
				setWheels(STOP);
				changingMode = false;
				return;
			}
			
			if(startFire) {
				startShootDown = System.currentTimeMillis();
				setWheels(OUTSPEED);
				startFire = false;
				firing = true;
			}
			
			if(firing == true && System.currentTimeMillis()-startShootDown > FIREDURATION) {
				setWheels(0);
				firing = false;
			}
			break;
		
		case DOWN: 
			setWheels(0);
			break;
			
		case UP:
			setWheels(0);
			break;
		}
	}
	
	public void setWheels(double val) {
		if(lastSpeed == val) 
			return;
		
		motor1.set(val);
		motor2.set(val);
		
		lastSpeed = val;
	}
	
	public void setMode(Mode m) {
		if(m != mode) {
			lastMode = mode;
			mode = m;
			changingMode = true;	
		}
	}
	
	public void revertMode() {
		mode = lastMode;
		changingMode = true;	
	}
	
	public void fire() {
		startFire = true;
	}
}